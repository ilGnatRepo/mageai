(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1221],{8666:function(n,e,i){"use strict";var u;i.d(e,{b:function(){return u}}),function(n){n.BLOCK="block",n.PIPELINE="pipeline"}(u||(u={}))},55620:function(n,e,i){"use strict";i.r(e),i.d(e,{default:function(){return Rn}});var u=i(77837),t=i(75582),r=i(21831),l=i(82394),o=i(38860),c=i.n(o),s=i(12691),a=i.n(s),d=i(82684),p=i(83455),f=i(34376),v=i(52749),h=i(60523),m=i(71180),b=i(90299),_=i(31882),Z=i(76111),j=i(94629),C=i(97618),x=i(55485),g=i(68562),I=i(65956),P=i(38276),T=i(30160),S=i(35576),k=i(17488),O=i(28598);var E=function(n){var e=n.description,i=n.isLoading,u=n.maxWidth,t=n.minWidth,r=n.noEmptyValue,l=n.onClose,o=n.onSave,c=n.textArea,s=n.title,a=n.value,p=(0,d.useRef)(null),f=(0,d.useState)(a),v=f[0],h=f[1],b=c?S.Z:k.Z;return(0,d.useEffect)((function(){var n;null==p||null===(n=p.current)||void 0===n||n.focus()}),[]),(0,O.jsxs)(I.Z,{maxWidth:u,minWidth:t,children:[(0,O.jsx)(T.ZP,{bold:!0,children:s}),(0,O.jsx)(P.Z,{mt:1,children:(0,O.jsx)(b,{monospace:!0,onChange:function(n){return h(n.target.value)},ref:p,rows:c?7:null,value:v})}),e&&(0,O.jsx)(P.Z,{mt:2,children:(0,O.jsx)(T.ZP,{muted:!0,small:!0,children:e})}),(0,O.jsx)(P.Z,{mt:3,children:(0,O.jsxs)(x.ZP,{children:[(0,O.jsx)(g.ZP,{bold:!0,inline:!0,loading:i,onClick:function(){v===a||r&&!v?l():o(v)},outline:!0,primary:!0,uuid:"Inputs/InputModal/SaveInput",children:"Save"}),(0,O.jsx)(P.Z,{ml:1}),(0,O.jsx)(m.ZP,{onClick:l,children:"Cancel"})]})})]})},y=i(48670),w=i(55072),A=i(57653),D=i(55729),M=i(93808),R=i(82359),G=i(44085),$=i(4190),U=i(75499),L=i(48381),B=i(85544),H=i(70026),N=i(35686),F=i(44897),Y=i(77417),Q=i(42631),z=i(44425),V=i(72473),q=i(23780),K=i(8666),W=i(46684),X=i(53808),J="pipeline_list_filters",nn="pipeline_list_group_bys",en="pipeline_list_sort_column_index",un="pipeline_list_sort_direction",tn="pipeline_list_selected_tab_uuid";function rn(n){return(0,X.t8)(J,n),n}function ln(n){return(0,X.t8)(nn,n),n}var on=i(11498),cn=i(32929),sn=i(44898),an=i(70515),dn=i(30229),pn=i(81655),fn=i(31608),vn=i(81728),hn=i(3917),mn=i(72619),bn=i(69419),_n=i(65458),Zn=i(15610),jn=i(42122),Cn=i(95924),xn=i(86735),gn=i(70320),In=i(89538),Pn=i(44952),Tn=i(43613);function Sn(n,e){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(n);e&&(u=u.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.push.apply(i,u)}return i}function kn(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Sn(Object(i),!0).forEach((function(e){(0,l.Z)(n,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):Sn(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}var On={Icon:V.Schedule,label:function(){return"最近查看"},uuid:"recent"},En={Icon:V.PipelineV3,label:function(n){return null!=n&&n.count?"所有管道 › ".concat((null==n?void 0:n.count)||0):"所有管道"},uuid:"all"},yn=[En,On],wn="tab",An=[A.$1.SEARCH],Dn={borderRadius:"".concat(Q.BG,"px"),iconOnly:!0,noBackground:!0,noBorder:!0,outline:!0,padding:"4px"};function Mn(){var n,e=(0,f.useRouter)(),i=(0,d.useRef)(null),u=(0,d.useRef)(null),o=(0,d.useRef)(null),c=(0,d.useRef)(null),s=(0,Y.Z)(),g=s.fetchProjects,I=s.project,S=(0,d.useState)(null),k=S[0],M=S[1],Q=(0,d.useState)(null),Sn=Q[0],Mn=Q[1],Rn=(0,d.useState)(null),Gn=Rn[0],$n=Rn[1],Un=(0,d.useCallback)((function(n){$n(n),clearTimeout(c.current),c.current=setTimeout((function(){var e;return(0,Zn.u)((e={},(0,l.Z)(e,on.$D.OFFSET,0),(0,l.Z)(e,A.$1.SEARCH,n),e))}),500)}),[$n]),Ln=(0,d.useState)({}),Bn=Ln[0],Hn=Ln[1],Nn=(0,d.useState)(null),Fn=Nn[0],Yn=Nn[1],Qn=(0,bn.iV)(),zn=kn({},(0,bn.DQ)(Qn,[A.$1.SEARCH,A.$1.STATUS,A.$1.TAG,A.$1.TYPE].concat((0,r.Z)(on.RG)))),Vn=(0,d.useMemo)((function(){return null==Qn?void 0:Qn[wn]}),[Qn]);(0,d.useEffect)((function(){var n;M(null==i||null===(n=i.current)||void 0===n?void 0:n.getBoundingClientRect().height)}),[Qn,i]);var qn=(0,d.useMemo)((function(){var n;return(0,gn.hY)(null==I||null===(n=I.features)||void 0===n?void 0:n[R.d.LOCAL_TIMEZONE])}),[null==I?void 0:I.features]),Kn=(0,d.useMemo)((function(){var n;return null==I||null===(n=I.features)||void 0===n?void 0:n[R.d.OPERATION_HISTORY]}),[I]),Wn=(0,d.useMemo)((function(){return qn?pn.O$:{}}),[qn]),Xn=N.ZP.pipelines.list(kn(kn({},zn),{},{include_schedules:1}),{revalidateOnFocus:!1}),Jn=Xn.data,ne=Xn.mutate,ee=(0,d.useMemo)((function(){return(null==Qn?void 0:Qn[A.$1.HISTORY_DAYS])||7}),[Qn]),ie=N.ZP.pipelines.list(kn(kn({},zn),{},(n={},(0,l.Z)(n,A.$1.HISTORY_DAYS,(0,vn.HW)(ee)?Number(ee):ee),(0,l.Z)(n,"include_schedules",1),n)),{},{pauseFetch:!Kn||!Vn||On.uuid!==Vn}),ue=ie.data,te=ie.mutate,re=(0,d.useCallback)((function(n){return n}),[]),le=(0,d.useMemo)((function(){var n=re((null==Jn?void 0:Jn.pipelines)||[]);if(null!=Qn&&Qn[A.$1.TAG]){var e=Qn[A.$1.TAG];n=n.filter((function(n){var i=n.tags;return i.some((function(n){return e.includes(n)}))||0===i.length&&e.includes(A.$1.NO_TAGS)}))}return n}),[Jn,re,Qn]),oe=(0,d.useMemo)((function(){return re((null==ue?void 0:ue.pipelines)||[])}),[ue,re]),ce=(0,d.useMemo)((function(){return[1,2,3,4,5,6,8,9]}),[]),se=null==Qn?void 0:Qn[pn.lG.SORT_COL_IDX],ae=null==Qn?void 0:Qn[pn.lG.SORT_DIRECTION],de=(0,d.useMemo)((function(){return se?{columnIndex:+se,sortDirection:ae||pn.sh.ASC}:void 0}),[se,ae]),pe=null==Qn?void 0:Qn[A.$1.GROUP],fe=(0,p.Db)((function(n){var e=n.pipelineUUID,i=n.filesOnly,u=void 0!==i&&i;return N.ZP.downloads.pipelines.useCreate(e)({download:{ignore_folder_structure:u}})}),{onSuccess:function(n){return(0,mn.wD)(n,{callback:function(){var e=n.data.download.token;(0,Pn.K)(e)},onErrorCallback:function(n,e){return Yn({errors:e,response:n})}})}}),ve=(0,t.Z)(fe,1)[0];(0,d.useEffect)((function(){null!=zn&&zn[A.$1.SEARCH]&&null===Gn&&$n(null==zn?void 0:zn[A.$1.SEARCH])}),[zn,Gn,$n]),(0,d.useEffect)((function(){var n,e={};if(!se){var i=(0,X.U2)(en,null),u=(0,X.U2)(un,pn.sh.ASC);null!==i&&(e[pn.lG.SORT_COL_IDX]=i,e[pn.lG.SORT_DIRECTION]=u)}Kn&&(Vn?(0,X.t8)(tn,Vn):e[wn]=(0,X.U2)(tn,null==yn||null===(n=yn[0])||void 0===n?void 0:n.uuid));if(pe)ln((0,l.Z)({},pe,!0));else{var r,o=(0,X.U2)(nn,{});o&&Object.entries(o).forEach((function(n){var e=(0,t.Z)(n,2),i=e[0],u=e[1];!r&&u&&(r=i)})),r&&(e[A.$1.GROUP]=r)}if((0,jn.Qr)(zn)){var c=(0,l.Z)({},on.$D.LIMIT,w.Q),s=(0,X.U2)(J,{});s&&Object.entries(s).forEach((function(n){var e=(0,t.Z)(n,2),i=e[0],u=e[1];null!=u&&(on.RG.includes(i)||An.includes(i)?c[i]=u:(c[i]=[],Object.entries(u).forEach((function(n){var e=(0,t.Z)(n,2),u=e[0];e[1]&&c[i].push(u)}))))})),(0,jn.Qr)(c)||(e={},Object.entries(kn(kn({},e),c)||{}).forEach((function(n){var i=(0,t.Z)(n,2),u=i[0],r=i[1];null!=r&&(e[u]=r)})))}else{var a={};Object.entries(zn).forEach((function(n){var e=(0,t.Z)(n,2),i=e[0],u=e[1];a[i]={};var r,l=u;null!=u&&(on.RG.includes(i)||An.includes(i)?a[i]=l:(Array.isArray(l)||(l=[l]),l&&Array.isArray(l)&&(null===(r=l)||void 0===r||r.forEach((function(n){a[i][n]=!0})))))})),rn((0,jn.hB)(a))}(0,jn.Qr)(e)||(0,Zn.u)((0,jn.hB)(e),{pushHistory:!1})}),[pe,Kn,zn,Vn,ce,se,ae]),(0,d.useEffect)((function(){(0,mn.bB)(Jn,Yn)}),[Jn]);var he=function(n){return(0,p.Db)(N.ZP.pipelines.useCreate(),{onSuccess:function(e){return(0,mn.wD)(e,{callback:function(e){var i=e.pipeline.uuid;null==n||n(i)},onErrorCallback:function(n,e){return Yn({errors:e,response:n})}})}})},me=he((function(n){return e.push("/pipelines/[pipeline]/edit","/pipelines/".concat(n,"/edit"))})),be=(0,t.Z)(me,2),_e=be[0],Ze=be[1].isLoading,je=he((function(){null==ne||ne(),null==te||te()})),Ce=(0,t.Z)(je,2),xe=Ce[0],ge=Ce[1].isLoading,Ie=(0,p.Db)((function(n){return N.ZP.pipelines.useUpdate(n.uuid)({pipeline:n})}),{onSuccess:function(n){return(0,mn.wD)(n,{callback:function(n){var e=n.pipeline.uuid;Hn((function(n){return kn(kn({},n),{},(0,l.Z)({},e,!1))})),ne(),null==te||te(),null==Ue||Ue(),Mn(null)},onErrorCallback:function(n,e){var i,u=null==n||null===(i=n.url_parameters)||void 0===i?void 0:i.pk;Hn((function(n){return kn(kn({},n),{},(0,l.Z)({},u,!1))})),Yn({errors:e,response:n})}})}}),Pe=(0,t.Z)(Ie,2),Te=Pe[0],Se=Pe[1].isLoading,ke=(0,p.Db)((function(n){return N.ZP.pipelines.useDelete(n)()}),{onSuccess:function(n){return(0,mn.wD)(n,{callback:function(){null==ne||ne(),null==te||te()},onErrorCallback:function(n,e){return Yn({errors:e,response:n})}})}}),Oe=(0,t.Z)(ke,2),Ee=Oe[0],ye=Oe[1].isLoading,we=(0,In.dd)((function(n){var e=n.pipelineType;return(0,O.jsx)(Z.Z,{onClose:Me,onSave:function(n){var i=n.name,u=n.description,t=n.tags;_e({pipeline:{description:u,name:i,tags:t,type:e}})},pipelineType:e})}),{},[_e],{background:!0,disableEscape:!0,uuid:"overview/create_pipeline"}),Ae=(0,t.Z)(we,2),De=Ae[0],Me=Ae[1],Re=(0,In.dd)((function(n){var e=n.pipeline,i=n.pipelineDescription,u=n.pipelineName;return(0,O.jsx)(E,{isLoading:Se,minWidth:55*an.iI,noEmptyValue:!!u,onClose:Ue,onSave:function(n){var i=e||Sn;if(i){var t=i.uuid,r={uuid:t};u?r.name=n:r.description=n,Hn((function(n){return kn(kn({},n),{},(0,l.Z)({},t,!0))})),Te(r)}},textArea:!u,title:u?"重命名管道":"编辑 ".concat(null==e?void 0:e.uuid," 的描述"),value:u||i})}),{},[Se,Sn],{background:!0,uuid:"rename_pipeline_and_save"}),Ge=(0,t.Z)(Re,2),$e=Ge[0],Ue=Ge[1],Le=(0,In.dd)((function(){return(0,O.jsx)(H.Z,{fetchPipelines:ne,onCancel:Ne})}),{},[ne],{background:!0,uuid:"upload_pipeline"}),Be=(0,t.Z)(Le,2),He=Be[0],Ne=Be[1],Fe=(0,In.dd)((function(){return(0,O.jsx)(q.BC,{children:(0,O.jsx)(h.Z,{contained:!0,onClickCustomTemplate:function(n){_e({pipeline:{custom_template_uuid:null==n?void 0:n.template_uuid,name:(0,vn.Y6)()}}).then((function(){ze()}))},showBreadcrumbs:!0,tabs:[cn.A2]})})}),{},[_e],{background:!0,uuid:"browse_templates"}),Ye=(0,t.Z)(Fe,2),Qe=Ye[0],ze=Ye[1],Ve=(0,In.dd)((function(n){var e=n.cancelButtonText,i=(n.header,n.onCancel),u=n.onSaveSuccess;return(0,O.jsx)(q.BC,{children:(0,O.jsx)(D.Z,{cancelButtonText:e,contained:!0,header:(0,O.jsx)(Tn.Z,{}),onCancel:function(){null==i||i(),We()},onSaveSuccess:function(n){g(),We(),null==u||u(n)}})})}),{},[g],{background:!0,uuid:"configure_project"}),qe=(0,t.Z)(Ve,2),Ke=qe[0],We=qe[1],Xe=(0,In.dd)((function(){return(0,O.jsx)(q.BC,{children:(0,O.jsx)(v.Z,{createPipeline:_e,isLoading:Ze,onClose:ei})})}),{},[_e,Ze],{background:!0,disableClickOutside:!0,disableCloseButton:!0,uuid:"AI_modal"}),Je=(0,t.Z)(Xe,2),ni=Je[0],ei=Je[1],ii=(0,d.useMemo)((function(){return(0,_n.d)(_e,{showAIModal:function(){null!=I&&I.openai_api_key?ni():Ke({onSaveSuccess:function(){ni()}})},showBrowseTemplates:Qe,showCreatePipelineModal:De,showImportPipelineModal:He})}),[_e,I,ni,Qe,Ke,De,He]),ui=N.ZP.tags.list().data,ti=(0,d.useMemo)((function(){return(0,xn.YC)((null==ui?void 0:ui.tags)||[],(function(n){return n.uuid}))}),[ui]),ri=(0,d.useMemo)((function(){return(0,O.jsx)(B.Z,{addButtonProps:{isLoading:Ze,label:"新建",menuItems:ii},deleteRowProps:{confirmationMessage:"这是不可逆的，将立即删除与管道相关的所有内容，包括其块、触发器、运行、日志和历史记录。",isLoading:ye,item:"pipeline",onDelete:function(){window.confirm("您确定要删除管道 ".concat(null==Sn?void 0:Sn.uuid," 吗？"))&&Ee(null==Sn?void 0:Sn.uuid)}},extraActionButtonProps:{Icon:V.Clone,confirmationDescription:"克隆选定的管道将创建一个具有相同配置和代码块的新管道。这些块使用与原始管道相同的块文件。管道触发器、运行、回填和日志不会被复制到新管道。",confirmationMessage:"您要克隆管道 ".concat(null==Sn?void 0:Sn.uuid," 吗？"),isLoading:ge,onClick:function(){return xe({pipeline:{clone_pipeline_uuid:null==Sn?void 0:Sn.uuid}})},openConfirmationDialogue:!0,tooltip:"克隆管道"},filterOptions:{status:A.kA,tag:[A.$1.NO_TAGS].concat((0,r.Z)(ti.map((function(n){return n.uuid})))),type:Object.values(A.qL)},filterValueLabelMapping:{status:A.kA.reduce((function(n,e){return kn(kn({},n),{},(0,l.Z)({},e,(0,vn.J3)((0,vn.kC)(e))))}),{}),tag:kn((0,l.Z)({},A.$1.NO_TAGS,"无标签"),ti.reduce((function(n,e){var i=e.uuid;return kn(kn({},n),{},(0,l.Z)({},i,i))}),{})),type:A.G7},groupButtonProps:{groupByLabel:pe,menuItems:[{beforeIcon:pe===A.r0.STATUS?(0,O.jsx)(V.Check,{fill:F.Z.content.default,size:1.5*an.iI}):(0,O.jsx)(V.Circle,{muted:!0,size:1.5*an.iI}),label:function(){return(0,vn.kC)(A.r0.STATUS)},onClick:function(){var n=pe===A.r0.STATUS?null:A.r0.STATUS;n||ln({}),(0,Zn.u)((0,l.Z)({},A.$1.GROUP,n),{pushHistory:!0})},uuid:"Pipelines/GroupMenu/Status"},{beforeIcon:pe===A.r0.TAG?(0,O.jsx)(V.Check,{fill:F.Z.content.default,size:1.5*an.iI}):(0,O.jsx)(V.Circle,{muted:!0,size:1.5*an.iI}),label:function(){return(0,vn.kC)(A.r0.TAG)},onClick:function(){var n=pe===A.r0.TAG?null:A.r0.TAG;n||ln({}),(0,Zn.u)((0,l.Z)({},A.$1.GROUP,n),{pushHistory:!0})},uuid:"Pipelines/GroupMenu/Tag"},{beforeIcon:pe===A.r0.TYPE?(0,O.jsx)(V.Check,{fill:F.Z.content.default,size:1.5*an.iI}):(0,O.jsx)(V.Circle,{muted:!0,size:1.5*an.iI}),label:function(){return(0,vn.kC)(A.r0.TYPE)},onClick:function(){var n=pe===A.r0.TYPE?null:A.r0.TYPE;n||ln({}),(0,Zn.u)((0,l.Z)({},A.$1.GROUP,n),{pushHistory:!0})},uuid:"Pipelines/GroupMenu/Type"}]},moreActionsMenuItems:[{label:function(){return"重命名管道"},onClick:function(){return $e({pipelineName:null==Sn?void 0:Sn.name})},uuid:"Pipelines/MoreActionsMenu/Rename"},{label:function(){return"编辑描述"},onClick:function(){return $e({pipeline:Sn,pipelineDescription:null==Sn?void 0:Sn.description})},uuid:"Pipelines/MoreActionsMenu/EditDescription"}],onClickFilterDefaults:function(){rn({}),$n(""),null==ne||ne().then((function(){var n;(0,Zn.u)((n={},(0,l.Z)(n,on.$D.LIMIT,(null==zn?void 0:zn[on.$D.LIMIT])||w.Q),(0,l.Z)(n,A.$1.SEARCH,""),n),{replaceParams:!0})}))},onFilterApply:function(n,e){Object.values(e).every((function(n){return!(null!=n&&n.length)}))&&rn({})},query:zn,resetLimitOnFilterApply:!0,searchProps:{onChange:Un,value:Gn},selectedRowId:null==Sn?void 0:Sn.uuid,setSelectedRow:Mn})}),[xe,Ee,ne,pe,ge,Ze,ye,ii,zn,Gn,Sn,Un,$e,ti]),li=(0,d.useCallback)((function(n){var e={};null==n||n.forEach((function(n,i){var u=null==n?void 0:n[pe];if(A.r0.STATUS===pe){var t=(n||{}).schedules,r=void 0===t?[]:t,l=r.length;u=r.find((function(n){var e=n.status;return dn.fq.ACTIVE===e}))?A.QK.ACTIVE:l>=1?A.QK.INACTIVE:A.QK.NO_SCHEDULES}else if(A.r0.TAG===pe){u=(null==n?void 0:n.tags)?(0,xn.YC)(n.tags,(function(n){return n})).join(", "):""}e[u]||(e[u]=[]),e[u].push(i)}));var i=[],u=[];A.r0.STATUS===pe?Object.values(A.QK).forEach((function(n){i.push(e[n]),u.push((0,vn.vg)(n))})):A.r0.TAG===pe?(0,xn.YC)(Object.keys(e),(function(n){return n})).forEach((function(n){i.push(e[n]),n?u.push(n.split(", ").map((function(n,e){return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{marginLeft:e>=1?4:0}},"".concat(n,"-").concat(e,"-spacing")),(0,O.jsx)(_.Z,{small:!0,children:(0,O.jsx)(T.ZP,{children:n})},"".concat(n,"-").concat(e))]})}))):u.push("无标签")})):A.r0.TYPE===pe&&Object.values(A.qL).forEach((function(n){i.push(e[n]),u.push(A.G7[n])}));var t=[],r=[];return null==i||i.forEach((function(n,e){null!=n&&(null==n?void 0:n.length)>=1&&(r.push(n),t.push(null==u?void 0:u[e]))})),{rowGroupHeaders:t,rowsGroupedByIndex:r}}),[pe]),oi=(0,d.useMemo)((function(){return li(le)}),[li,le]),ci=oi.rowGroupHeaders,si=oi.rowsGroupedByIndex,ai=(0,d.useMemo)((function(){return li(oe)}),[li,oe]),di=ai.rowGroupHeaders,pi=ai.rowsGroupedByIndex,fi=(0,d.useCallback)((function(n,i,t){return(0,O.jsx)(U.Z,{columnFlex:[null,null,null,2,null,null,null,1,null,null,null],columns:[{label:function(){return""},uuid:"action"},{uuid:(0,vn.kC)(A.r0.STATUS)},{uuid:"名称"},{uuid:"描述"},{uuid:(0,vn.kC)(A.r0.TYPE)},kn(kn({},Wn),{},{uuid:"更新于"}),kn(kn({},Wn),{},{uuid:"创建于"}),{uuid:"标签"},{uuid:"块"},{uuid:"触发器"},{center:!0,label:function(){return""},uuid:"操作"}],isSelectedRow:function(e){var i;return(null===(i=n[e])||void 0===i?void 0:i.uuid)===(null==Sn?void 0:Sn.uuid)},localStorageKeySortColIdx:en,localStorageKeySortDirection:un,onClickRow:function(e){return Mn((function(i){var u=n[e];return(null==i?void 0:i.uuid)!==(null==u?void 0:u.uuid)?u:null}))},onDoubleClickRow:function(i){e.push("/pipelines/[pipeline]/edit","/pipelines/".concat(n[i].uuid,"/edit"))},ref:u,renderRightClickMenuItems:function(i){var u=n[i];return[{label:function(){return"编辑描述"},onClick:function(){return $e({pipeline:u,pipelineDescription:null==u?void 0:u.description})},uuid:"edit_description"},{label:function(){return"重命名"},onClick:function(){return $e({pipeline:u,pipelineName:null==u?void 0:u.name})},uuid:"rename"},{label:function(){return"克隆"},onClick:function(){return xe({pipeline:{clone_pipeline_uuid:null==u?void 0:u.uuid}})},uuid:"clone"},{label:function(){return"下载（保留文件夹结构）"},onClick:function(){ve({filesOnly:!1,pipelineUUID:null==u?void 0:u.uuid})},uuid:"download_keep_folder_structure"},{label:function(){return"下载（不包含文件夹结构）"},onClick:function(){ve({filesOnly:!0,pipelineUUID:null==u?void 0:u.uuid})},uuid:"download_without_folder_structure"},{label:function(){return"添加/删除标签"},onClick:function(){e.push("/pipelines/[pipeline]/settings","/pipelines/".concat(null==u?void 0:u.uuid,"/settings"))},uuid:"add_tags"},{label:function(){return"创建模板"},onClick:function(){e.push("/templates?object_type=".concat(sn.R,"&new=1&pipeline_uuid=").concat(null==u?void 0:u.uuid))},uuid:"create_custom_template"},{label:function(){return"创建全局数据产品"},onClick:function(){e.push("/global-data-products?object_type=".concat(K.b.PIPELINE,"&new=1&object_uuid=").concat(null==u?void 0:u.uuid))},uuid:"create_global_data_product"},{label:function(){return"删除"},onClick:function(){window.confirm("您确定要删除管道 ".concat(null==u?void 0:u.uuid," 吗？"))&&Ee(null==u?void 0:u.uuid)},uuid:"delete"}]},rightClickMenuHeight:252,rightClickMenuWidth:30*an.iI,rowGroupHeaders:i,rows:null==n?void 0:n.map((function(n,i){var u=n.blocks,t=n.created_at,r=n.description,o=n.schedules,c=n.tags,s=n.type,d=n.updated_at,p=n.uuid,f=u.filter((function(n){var e=n.type;return z.tf.SCRATCHPAD!==e})).length,v=o.length,h=o.find((function(n){var e=n.status;return dn.fq.ACTIVE===e})),b=s===A.ad,_=(0,O.jsx)("div",{children:(0,O.jsx)(L.Z,{tags:null==c?void 0:c.map((function(n){return{uuid:n}}))})},"pipeline_tags_".concat(i));return[v>=1||Bn[p]?(0,O.jsx)(m.ZP,{iconOnly:!0,loading:!!Bn[p],noBackground:!0,noBorder:!0,noPadding:!0,onClick:function(e){(0,Cn.j)(e),Hn((function(n){return kn(kn({},n),{},(0,l.Z)({},p,!0))})),Te(kn(kn({},n),{},{status:h?dn.fq.INACTIVE:dn.fq.ACTIVE}))},children:h?(0,O.jsx)(V.Pause,{muted:!0,size:2*an.iI}):(0,O.jsx)(V.PlayButtonFilled,{default:!0,size:2*an.iI})}):null,(0,O.jsx)(T.ZP,{default:!h,monospace:!0,success:!!h,children:h?dn.fq.ACTIVE:v>=1?dn.fq.INACTIVE:"无计划"},"pipeline_status_".concat(i)),(0,O.jsx)(a(),{as:"/pipelines/".concat(p),href:"/pipelines/[pipeline]",passHref:!0,children:(0,O.jsx)(y.Z,{sameColorAsText:!0,children:p})},"pipeline_name_".concat(i)),(0,O.jsx)(T.ZP,{default:!0,preWrap:!0,title:r,children:r},"pipeline_description_".concat(i)),(0,O.jsx)(T.ZP,{bold:b,danger:b,children:b?(0,vn.kC)(A.ad):A.G7[s]},"pipeline_type_".concat(i)),(0,O.jsx)(T.ZP,{monospace:!0,small:!0,title:d?(0,hn._6)(d):null,children:d?(0,hn.XG)((0,hn.d$)(d,{includeSeconds:!0,utcFormat:!0}),qn):(0,O.jsx)(O.Fragment,{children:"—"})},"pipeline_updated_at_".concat(i)),(0,O.jsx)(T.ZP,{monospace:!0,small:!0,title:t?(0,hn._6)(t):null,children:t?(0,hn.XG)(t.slice(0,19),qn):(0,O.jsx)(O.Fragment,{children:"—"})},"pipeline_created_at_".concat(i)),_,(0,O.jsx)(T.ZP,{default:0===f,monospace:!0,children:f},"pipeline_block_count_".concat(i)),(0,O.jsx)(T.ZP,{default:0===v,monospace:!0,children:v},"pipeline_trigger_count_".concat(i)),(0,O.jsxs)(C.Z,{flex:1,justifyContent:"flex-end",children:[(0,O.jsx)(m.ZP,kn(kn({},Dn),{},{onClick:function(){ve({pipelineUUID:p})},title:"下载（保留文件夹结构）",children:(0,O.jsx)(V.Save,{default:!0,size:2*an.iI})})),(0,O.jsx)(P.Z,{mr:1}),(0,O.jsx)(m.ZP,kn(kn({},Dn),{},{onClick:function(){e.push("/pipelines/[pipeline]","/pipelines/".concat(p))},title:"详情",children:(0,O.jsx)(V.Open,{default:!0,size:2*an.iI})})),(0,O.jsx)(P.Z,{mr:1}),(0,O.jsx)(m.ZP,kn(kn({},Dn),{},{onClick:function(){e.push("/pipelines/[pipeline]/logs","/pipelines/".concat(p,"/logs"))},title:"日志",children:(0,O.jsx)(V.File,{default:!0,size:2*an.iI})}))]},"chevron_icon_".concat(i))]})),rowsGroupedByIndex:t,sortableColumnIndexes:ce,sortedColumn:de,stickyHeader:!0,uuid:"pipelines_table"})}),[xe,Ee,ve,qn,Bn,e,Sn,Hn,Mn,$e,ce,de,Wn,Te]),vi=(0,d.useMemo)((function(){return fi(le,ci,si)}),[le,fi,ci,si]),hi=(0,d.useMemo)((function(){return fi(oe,di,pi)}),[oe,fi,di,pi]),mi=(0,d.useMemo)((function(){return(null==le?void 0:le.length)||0}),[le]),bi=(0,d.useMemo)((function(){return(null==oe?void 0:oe.length)||0}),[oe]),_i=(0,d.useMemo)((function(){return(!Kn||En.uuid===Vn)&&!mi||Kn&&On.uuid===Vn&&!bi}),[Kn,mi,bi,Vn]),Zi=(0,d.useMemo)((function(){var n=null==zn?void 0:zn[on.$D.LIMIT];return(0,O.jsxs)(x.ZP,{alignItems:"center",children:[(0,O.jsx)(T.ZP,{muted:!0,small:!0,children:"每页"}),(0,O.jsx)(P.Z,{mr:1}),(0,O.jsxs)(G.Z,{compact:!0,onChange:function(n){var e;return(0,Zn.u)((e={},(0,l.Z)(e,on.$D.LIMIT,n.target.value),(0,l.Z)(e,on.$D.OFFSET,0),e),{pushHistory:!0})},small:!0,value:n,children:[n&&(n>5*w.Q||n%w.Q)&&(0,O.jsx)("option",{value:n,children:n}),(0,xn.w6)(5).map((function(n,e){var i=(e+1)*w.Q;return(0,O.jsx)("option",{value:i,children:i},i)}))]})]})}),[zn]),ji=(0,d.useMemo)((function(){var n,e,i=Jn;Kn&&On.uuid===Vn&&(i=ue);var u=(null===(n=i)||void 0===n||null===(e=n.metadata)||void 0===e?void 0:e.count)||0,t=(null==zn?void 0:zn[on.$D.LIMIT])||w.Q,r=(null==zn?void 0:zn[on.$D.OFFSET])||0,o=Math.ceil(u/t);return(0,O.jsx)(P.Z,{p:an.cd,children:(0,O.jsx)(w.ZP,{maxPages:w.Et,onUpdate:function(n){var e=Number(n);(0,Zn.u)((0,l.Z)({},on.$D.OFFSET,e*t))},page:Math.floor(r/t),totalPages:o})})}),[Jn,ue,Kn,zn,Vn]);return(0,O.jsxs)(j.Z,{errors:Fn,setErrors:Yn,subheaderChildren:(0,O.jsxs)(x.ZP,{alignItems:"center",justifyContent:"space-between",children:[ri,Zi]}),title:"管道",uuid:"pipelines/index",children:[Kn&&(0,O.jsx)(P.Z,{px:an.cd,ref:i,children:(0,O.jsx)(b.Z,{noPadding:!0,onClickTab:function(n){var e,i=n.uuid;return(0,Zn.u)((e={},(0,l.Z)(e,wn,i),(0,l.Z)(e,on.$D.OFFSET,0),e),{pushHistory:!0})},regularSizeText:!0,selectedTabUUID:Vn,tabs:yn.map((function(n){var e=n.Icon,i=n.label;return{Icon:e,label:function(){var n;return i({count:null==Jn||null===(n=Jn.metadata)||void 0===n?void 0:n.count})},uuid:n.uuid}})),underlineStyle:!0})}),_i?(0,O.jsx)(P.Z,{p:an.Mq,children:Jn?(0,O.jsx)(T.ZP,{bold:!0,default:!0,monospace:!0,muted:!0,children:"无可用管道"}):(0,O.jsx)($.Z,{inverted:!0,large:!0})}):null,(0,O.jsxs)(fn.cl,{hide:_i,includePadding:!!pe,maxHeight:"calc(100vh - ".concat(W.Mz+74+(k||44)+68,"px)"),children:[(!Kn||En.uuid===Vn)&&vi,Kn&&On.uuid===Vn&&hi]}),(0,O.jsx)("div",{ref:o,children:ji})]})}Mn.getInitialProps=(0,u.Z)(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",{});case 1:case"end":return n.stop()}}),n)})));var Rn=(0,M.Z)(Mn)},79274:function(n,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pipelines",function(){return i(55620)}])},80022:function(n,e,i){"use strict";function u(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}i.d(e,{Z:function(){return u}})},15544:function(n,e,i){"use strict";function u(n){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},u(n)}i.d(e,{Z:function(){return u}})},13692:function(n,e,i){"use strict";i.d(e,{Z:function(){return t}});var u=i(61049);function t(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&(0,u.Z)(n,e)}},93189:function(n,e,i){"use strict";i.d(e,{Z:function(){return r}});var u=i(12539),t=i(80022);function r(n,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return(0,t.Z)(n)}}},function(n){n.O(0,[449,4241,5544,523,6427,9774,2888,179],(function(){return e=79274,n(n.s=e);var e}));var e=n.O();_N_E=e}]);